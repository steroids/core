# Контроллеры, экшены и разбор URL

В Yii2 уже есть все необходимое для разбора URL, поиска контроллера и запуска экшена. Однако, централизованная запись
правил URL в `UrlManager` не подходит для модульного подхода, который ожидают приложения на Steroids.

Также, помимо правил парсинга URL могут быть еще другие данные, которые хочется указать для каждого АПИ метода, например
заголовок, описывающий суть метода. Поэтому в Steroids объявление экшенов и методов API вынесено в статичные методы
модулей и контроллеров - `apiMap()` и `siteMap()`.

```php
class AgreementsController extends Controller
{
    public static function apiMap()
    {
        return [
            'agreement' => [
                'items' => [
                    // Краткая запись
                    'get' => 'GET /api/v1/agreements/<id>',
                    
                    // Подробная запись
                    'get' => [
                        'label' => 'Получение договора по ID',
                        'url' => ['/agreement/agreements/get'],
                        'urlRule' => 'GET /api/v1/agreements/<id>',
                    ],
                ],
            ],
        ];
    }

    public static function siteMap()
    {
        return [
            'agreement' => [
                'items' => [
                    'download' => 'GET /backend/agreements/download/<uid>',
                ],
            ],
        ];
    }
    
    public function actionGet()
    {
        // ...
    }
}
```

Все экшены укладываются в общую "карту сайта", которая составляется при получении кусочков "карт" из модулей и
контроллеров. Ключи массивов как раз указывают на вложенность, в данном случае карта сайта будет такой:

```
api
    agreement
        get
agreement
    download
```

Метод `agreement.get` был добавлен в дерево `api`, потому что был объявлен в методе `apiMap`. Метод `apiMap()` только
этим и отличается от `siteMap()`. Вложенность дерева может быть не ограниченная.

Получившуюся карту сайта можно посмотреть в `gii`, и там же указать права доступа по ролям пользователя как для группы
экшенев (среза дерева), так и индивидуально для каждого. Проверка прав осуществляется классом
`\steroids\core\middleware\AccessMiddleware`, который запускается на каждый HTTP запрос.

Если необходимо экшены контроллера разместить в определенном месте карты сайта, то можно записать путь до этого места
через точки, например:

```php
    'api.users.agreement' => [ // Будет размещен в соответствующей части карты сайта
        'items' => [
            'get' => 'GET /api/v1/agreements/<id>',
        ],
    ],
```

