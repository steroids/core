# Модель ActiveRecord

Класс `steroids\base\Model` наследуется от `yii\db\ActiveRecord` и не меняет интерфейс класса, а лишь добавляет в него
некоторый "сахар" и возможности. Поэтому его легко можно использовать вместо `ActiveRecord`. Ниже описаны
добавленные возможности.


## Транзакции

В методе базовой модели `Model::transactions()` изменено поведение по-умолчанию. Транзакционное сохранение используется
для всех операций создания и сохранения сущности. Данное изменение было сделано как наиболее часто используемое в проектах.

```php
public function transactions()
{
    return [
        self::SCENARIO_DEFAULT => self::OP_ALL,
    ];
}
```


## Методы с исключениями

В базовую модель `steroids\base\Model` добавлены вспомогательные методы для поиска, сохранения и удаления сущности, которые в
случае неуспеха возвращают исключение. Таким образом, не нужно каждый раз проверять результат сохранения или поиска сущности.

### `Model::findOrPanic($condition)`

Было:

```php
$model = MyModel::findOne(['id' => $id]);
if (!$model) {
    throw new NotFoundHttpException('Запись не найдена');
}
```

Стало

```php
$model = MyModel::findOrPanic(['id' => $id]);
```

### `Model::saveOrPanic($attributeNames = null)`

Используется в случаях, когда по бизнес логике модель однозначно должна сохраниться и все данные пользователя уже проверены.

Было:

```php
if (!$model->save()) {
    throw new Exception();
}
```

Стало

```php
$model->saveOrPanic();
```

### `Model::deleteOrPanic()`

Было:

```php
if (!$model->delete()) {
    throw new Exception();
}
```

Стало

```php
$model->deleteOrPanic();
```


## Отображение по-умолчанию

Обычно в приложении почти у каждой сущности можно выделить поле, отвечающее за ее "заголовок".
Это `username` у пользователя, `title` у статьи или новости, `id + date` у лицензии и так далее.
Аналогично у сущностей есть одна или несколько страниц для отображения детальной информации о ней
(профиль пользователя, страница новости, подробности по лицензии).

Методы могут применяться, например, при автоматическом построении документации или админки.

### `Model::getModelLabel()`

Чтобы указать какое поле используется в качестве заголовка, добавлен метод `getModelLabel()`, который по-умолчанию
пытается найти поля `title`, `label`, `name` для отображения. Если их нет - выводит идентификатор: `#23`.

Пример использования:

```php
/**
 * @return string
 */
public function getModelLabel() {
    return $this->title;
}
```

### `Model::getRequestParamName()`

Этот статичный метод возвращает имя переменной, использующейся в роутах для указания идентификатора сущности.
Обычно мы всегда используем имя `id` для указания параметра, однако когда в роуте нужно указать несколько идентификаторов,
то имя `id` уже становится не понятным и требует рефакторинга (`id` -> `gameId`).

**Важно!** Поэтому лучше **всегда** указывать имена переменных, содержащие имя сущности.

Не верно:

```php
['/game/game/view', 'id' => $this->id],
```

Правильно:

```php
['/game/game/view', 'gameId' => $this->id],
```

По-умолчанию метод `Model::getRequestParamName()` возвращает `lcfirst()` от имени модели + `Id`.
Например, для модели `LicenseOrder` будет возвращено имя `licenseOrderId`.

