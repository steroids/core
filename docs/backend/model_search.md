# Модель Search

Модели, наследуемые от базового класса `\steroids\core\base\SearchModel` используются для поисковых запросов, где
необходимо выбрать данные с пагинацией, фильтрацией или сортировкой.

Модель наследует `\steroids\core\base\FormModel`, поэтому ведет себя как модель формы, где в атрибуты формы записываются
значения фильтров, пришедшие от пользователя. Эти данные валидируются стандартной yii2 валидацией формы и только при
успехе происходит поиск.

Модель включает стандартные поля для реализации пагинации и сортировки:

- `page` Номер страницы;
- `pageSize` Количество записей на странице;
- `sort` Массив атрибутов, по которым нужно сортировать. Для обратной (DESC) сортировки перед атрибутом
  необходимо поставить `!`.
- `scope` Строка или массив строк, в которых указаны дополнительные группы данных, необходимые в ответе. Поддерживаются:
    - `model` Вернет названия моделей `model` и `searchModel` в параметре `meta`)
    - `permissions` Для каждой модели добавить `canView`, `canUpdate`, `can...` флаги

Пример такой модели продемонстрирован ниже.

```php
class OperationsSearch extends OperationsSearchMeta
{
    public function fields()
    {
        return [
            'id',
            'name',
        ];
    }


    public function sortFields()
    {
        return [
            'id'
        ];
    }
    
    public function prepare($query)
    {
        parent::prepare($query);
        
        $query->andFilterWhere([
            'name' => $this->name,
        ]);
    }
}
```

Рассмотрим основные методы, которые можно переопределять.


## Метод `prepare($query)`

В этот метод передается `\yii\db\ActiveQuery` (возвращаемый методом `createQuery()`), который необходимо наполнить
условиями.


## Методы `fields()` и `fieldsSchema()`

Указывают какие данные нужно возвращать для каждой из моделей. Формат и применение можно посмотреть в разделе
[Публичные поля и схемы](model_fields.md).


## Метод `createQuery()`

Метод создания `Query`, возвращающий экземпляр запроса `\yii\db\QueryInterface`. В большинстве случаев это
`\yii\db\ActiveQuery`, созданный вызовом статичным методом модели `find` - `MyModel::find()`.


## Метод `createProvider()`

Метод создания провайдера данных. Может возвращать либо массив конфигурации для `\yii\data\ActiveDataProvider`
(используется по-умолчанию), либо создавать новый экземпляр провайдера, следуя интерфейсу `\yii\data\DataProviderInterface`.
